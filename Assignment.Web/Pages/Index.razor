@page "/"

@using Assignment.Application.Services;
@using Assignment.Application.DTO;
@inject IListProcessor listService

<table class="table">
    <tr>
        <td>
            <label>Name</label>
        </td>
        <td>
            <input @bind="name" />
        </td>
    </tr>
    <tr>
        <td>
            <label>Last Name</label>
        </td>
        <td>
            <input @bind="lastName" />
        </td>
    </tr>
    <tr>
        <td>
            <button class="btn btn-primary" @onclick="Send">Call service</button>
        </td>
        <td>
            <input @bind="selectedGuid" />
        </td>

    </tr>
    <tr>
        <td>
            <button class="btn btn-primary" @onclick="CheckStatus">Check Status</button>
        </td>
        <td>
            <label>Progress</label><input @bind="progress" />
        </td>
    </tr>

</table>

<table class="table">
    <thead>
        <tr>
            <th>Index</th>
            <th>Name</th>

        </tr>
    </thead>
    <tbody>
        @if (processReq != null)
        {
            foreach (var output in processReq.Outputs)
            {
                <tr>
                    <td>@output.Ordinal</td>
                    <td>@output.Value</td>
                </tr>
            }
        }

    </tbody>
</table>


@code {



    private ProcessRequestDto processReq = null;
    private string name, lastName;

    private Guid selectedGuid;
    private int progress = 0;

    private void Send()
    {
        selectedGuid = listService.ProcessList(name, lastName);
        progress = 0;
    }

    private void CheckStatus()
    {
        processReq = listService.GetStatus(selectedGuid);
        progress = (int)processReq.Progress;
    }

}
